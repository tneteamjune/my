{% extends 'layouts/default.html' %}
{% load static %}
{% load mathTags %}
{% block content %}

<head>
  <script src="{% static 'js/Chart.bundle.min.js' %}"></script>
  <script src="{% static 'js/loading-bar.js' %}"></script>
  <link rel="stylesheet" href="{% static 'css/loading-bar.css' %}">
  <script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>
 </head>

 <p>
<div class="student container">
  <div class="row">
    <div class="col">
      <div class ="student-breakdown">
        <div class= "shadow text-center">
          <div class="lineage">
            <h3><span class='text-black'>안녕하세요,
               <span class='text-black' style='font-weight:bold;'>{{ user.first_name }}</span>
              <span class='text-black'> 님!</h3>
          </div>

          <h2 style='text-align: right'>
            <a class="btn btn-light lineage" href="{% url 'common:my_contact' %}"role="button"
            aria-expanded="false" aria-controls="history">
           나의 제안
           </a>
            <a class="btn btn-light lineage" href="{% url 'common:change' %}"role="button"
             aria-expanded="false" aria-controls="history">
            회원정보변경
            </a>
           </h2>

          <table class="table table-light bg-light table-bordered table-condensed table-striped table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <td>{{ user.username }}</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>이름</th>
                <td>{{ user.first_name }}</td>
              </tr>
              <tr>
                <th>연락처</th>
                <td>{{ user.last_name }}</td>
              </tr>
              <tr>
                <th>이메일</th>
                <td>{{ user.email }}</td>
              </tr>

            </tbody>
          </table>

          <p>
          {% with percent=user.profile.greenpoint|divide:totalPoints %}
          <div class ="hr-large lineage"></div>
          <h4><span class='text-black'>초록점수  </span><span class = "text-success lineage">{{ user.profile.greenpoint }} points<span class='text-black'> 를 모으셨어요.  </span></h4>
          {% endwith %}
          <a class="btn btn-success lineage" href="{% url 'common:coupon' %}"role="button"
          aria-expanded="false" aria-controls="history">
          나의 초록쿠폰 {{ user.profile.coupon }}매
         </a>
          

        {% comment %} <form method="post" class="post-form" action="{% url 'common:mypage' %}">
            {% csrf_token %}
            <input type="hidden" class="form-control" name="reason" id="reason"
            value="{{ '제안 채택' |default_if_none:contact.id }}">
            <input type="hidden" class="form-control" name="event" id="event"
            value="{{ '4.쿠폰교환' }}">
            <button type="submit" class="btn btn-success">점수받기</button>
        </form>  {% endcomment %}

          <div class="collapsable spacedCol text-left">
              <p style='text-align: right'>
              <a class="btn btn-dark lineage" data-toggle="collapse" href="#history" role="button" 
              aria-expanded="false" aria-controls="history">
                적립내역상세
              </a>
            </p>
            <div class="collapse" id="history">
              <div class="card card-body bg-dark">
                {% for entry in pointArr %}
                <div class="row">
                    <div class="col">
                      <p><span class="text-success" style='font-weight:bold;'>{{ entry.point }} points</span> <span class='text-white'>from {{ entry.reason }} on {{ entry.date }}</span></p>
                    </div>
                </div>
                {% endfor %}

              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <!-- Start doughnut chart -->
              <canvas id="distChart" height="400" width="400"></canvas>
              <script type="text/javascript">
                var ctx = document.getElementById('distChart');
                var myChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [ '나의 초록점수', "쿠폰 획득까지 남은 초록점수"],
                        datasets: [{
                            label: 'Point distribution',
                            data: [ {{ user.profile.greenpoint }}, {{ couponPoints }}-{{totalPoints}} ],
                            backgroundColor: [
                                'rgba(5, 151, 5, 0.7)',
                                'rgba(210, 216, 210, 0.2)'
                            ],
                            borderColor: [
                                'rgba(3, 48, 3, 0.8)',
                                'rgba(158, 159, 158, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        title: {
                          display: true,
                          text: 'Point distribution'
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                        pieceLabel: {
                        },
                    }
                });
              </script>
              <!-- End doughnot chart -->
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
<p>
  <p>

{% endblock %}
